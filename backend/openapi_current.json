{"openapi":"3.1.0","info":{"title":"Truck Planner Backend","version":"0.1.0"},"paths":{"/health":{"get":{"summary":"Health","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Health Health Get"}}}}}}},"/db/ping":{"get":{"summary":"Db Ping","description":"Test connection to Supabase Postgres using SUPABASE_DB_URL.\n\nReturns a tiny payload with server_version and current_timestamp from the DB.","operationId":"db_ping_db_ping_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Db Ping Db Ping Get"}}}}}}},"/upload/preview":{"post":{"summary":"Upload Preview","operationId":"upload_preview_upload_preview_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_preview_upload_preview_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UploadPreviewResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/optimize":{"post":{"summary":"Optimize","operationId":"optimize_optimize_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_optimize_optimize_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OptimizeResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/geocode/validate":{"post":{"summary":"Geocode Validate","description":"Phase 1: extract addresses, geocode via Google if key present, and cache results.\n\nIf GOOGLE_MAPS_API_KEY is not configured, returns detected addresses without lat/lng.\nSet planningWhse to empty string, \"ALL\", or \"*\" to process all warehouses.","operationId":"geocode_validate_geocode_validate_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_geocode_validate_geocode_validate_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Geocode Validate Geocode Validate Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/distance-matrix":{"post":{"summary":"Distance Matrix","description":"Compute distance and duration matrices. Uses Google if key exists; fallback to Haversine.\n\nCaches results in distance_cache table to avoid repeated API calls.\nAccepts pipe-separated lat,lng pairs for origins and destinations.","operationId":"distance_matrix_distance_matrix_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_distance_matrix_distance_matrix_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Distance Matrix Distance Matrix Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/depot/location":{"get":{"summary":"Depot Get","operationId":"depot_get_depot_location_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Depot Get Depot Location Get"}}}}}},"put":{"summary":"Depot Put","operationId":"depot_put_depot_location_put","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"allOf":[{"$ref":"#/components/schemas/Body_depot_put_depot_location_put"}],"title":"Body"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Depot Put Depot Location Put"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/route/optimize-phase2":{"post":{"summary":"Route Optimize Phase2","description":"Phase 2: Geographic clustering + TSP route optimization.\n\nReturns optimized routes with stop sequences and map visualization data.","operationId":"route_optimize_phase2_route_optimize_phase2_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_route_optimize_phase2_route_optimize_phase2_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Route Optimize Phase2 Route Optimize Phase2 Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/route/plan":{"post":{"summary":"Route Plan","description":"Phase 1 routing foundation endpoint.\n\nFor now, this reuses deterministic grouping while honoring:\n- Planning Whse filter\n- Optional delivery date filter against Earliest Due (<= deliveryDate)\n- Max weight limits per TX vs other states\n\nFuture phases will compute geocoding, distance matrices, and route ordering.","operationId":"route_plan_route_plan_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_route_plan_route_plan_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OptimizeResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/export/trucks":{"post":{"summary":"Export Trucks","description":"Export optimized truck assignments to Excel format","operationId":"export_trucks_export_trucks_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_export_trucks_export_trucks_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/no-multi-stop-customers":{"get":{"summary":"Get No Multi Stop Customers","description":"Get list of customers that cannot be combined with others","operationId":"get_no_multi_stop_customers_no_multi_stop_customers_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"items":{"type":"string"},"type":"array"},"type":"object","title":"Response Get No Multi Stop Customers No Multi Stop Customers Get"}}}}}},"post":{"summary":"Update No Multi Stop Customers","description":"Update list of customers that cannot be combined with others","operationId":"update_no_multi_stop_customers_no_multi_stop_customers_post","requestBody":{"content":{"application/json":{"schema":{"items":{"type":"string"},"type":"array","title":"Customers"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"string"},"type":"object","title":"Response Update No Multi Stop Customers No Multi Stop Customers Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/combine-trucks":{"post":{"summary":"Combine Trucks","description":"Combine selected lines into a single truck.\n\nNotes:\n- Stateless: recomputes trucks/assignments from the uploaded file.\n- Matches selected lines by (SO, Line) ignoring the client-side truck numbers to avoid numbering drift.\n- Chooses the lightest truck among those containing the selected lines as the target truck.","operationId":"combine_trucks_combine_trucks_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_combine_trucks_combine_trucks_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CombineTrucksResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/export/dh-load-list":{"post":{"summary":"Export Dh Load List","description":"Export a DH Load List Excel per mapping.\n\n- Optional Planned Delivery column via 'plannedDeliveryCol' (UI now defaults to next business day)\n- Inserts a blue info row between transports (loads) with per-load stats in italics\n- Adds hidden blank column C to match provided layout","operationId":"export_dh_load_list_export_dh_load_list_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_export_dh_load_list_export_dh_load_list_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_combine_trucks_combine_trucks_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"request":{"type":"string","title":"Request"},"planningWhse":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planningwhse"}},"type":"object","required":["file","request"],"title":"Body_combine_trucks_combine_trucks_post"},"Body_depot_put_depot_location_put":{"properties":{"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"address":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Address"},"latitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Latitude"},"longitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Longitude"}},"type":"object","title":"Body_depot_put_depot_location_put"},"Body_distance_matrix_distance_matrix_post":{"properties":{"origins":{"type":"string","title":"Origins"},"destinations":{"type":"string","title":"Destinations"}},"type":"object","required":["origins","destinations"],"title":"Body_distance_matrix_distance_matrix_post"},"Body_export_dh_load_list_export_dh_load_list_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"plannedDeliveryCol":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planneddeliverycol"},"planningWhse":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planningwhse","default":"ZAC"}},"type":"object","required":["file"],"title":"Body_export_dh_load_list_export_dh_load_list_post"},"Body_export_trucks_export_trucks_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"planningWhse":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planningwhse","default":"ZAC"}},"type":"object","required":["file"],"title":"Body_export_trucks_export_trucks_post"},"Body_geocode_validate_geocode_validate_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"planningWhse":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planningwhse","default":"ZAC"}},"type":"object","required":["file"],"title":"Body_geocode_validate_geocode_validate_post"},"Body_optimize_optimize_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"planningWhse":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planningwhse","default":"ZAC"}},"type":"object","required":["file"],"title":"Body_optimize_optimize_post"},"Body_route_optimize_phase2_route_optimize_phase2_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"planningWhse":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planningwhse","default":"ZAC"},"maxWeightPerTruck":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Maxweightpertruck","default":52000},"maxStopsPerTruck":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Maxstopspertruck","default":20},"maxDriveTimeMinutes":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Maxdrivetimeminutes","default":720},"serviceTimePerStopMinutes":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Servicetimeperstopminutes","default":30},"maxTrucks":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Maxtrucks","default":50}},"type":"object","required":["file"],"title":"Body_route_optimize_phase2_route_optimize_phase2_post"},"Body_route_plan_route_plan_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"planningWhse":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Planningwhse","default":"ZAC"},"deliveryDate":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Deliverydate"},"startLocation":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Startlocation"},"endLocation":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Endlocation"},"truckHours":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Truckhours","default":10},"minutesPerStop":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Minutesperstop","default":30},"texasMaxWeight":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Texasmaxweight","default":52000},"otherMaxWeight":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Othermaxweight","default":48000}},"type":"object","required":["file"],"title":"Body_route_plan_route_plan_post"},"Body_upload_preview_upload_preview_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"}},"type":"object","required":["file"],"title":"Body_upload_preview_upload_preview_post"},"CombineTrucksResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"message":{"type":"string","title":"Message"},"newTruck":{"anyOf":[{"$ref":"#/components/schemas/TruckSummary"},{"type":"null"}]},"updatedAssignments":{"items":{"$ref":"#/components/schemas/LineAssignment"},"type":"array","title":"Updatedassignments"},"removedTruckIds":{"items":{"type":"integer"},"type":"array","title":"Removedtruckids"}},"type":"object","required":["success","message","updatedAssignments","removedTruckIds"],"title":"CombineTrucksResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LineAssignment":{"properties":{"truckNumber":{"type":"integer","title":"Trucknumber"},"so":{"type":"string","title":"So"},"line":{"type":"string","title":"Line"},"trttav_no":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Trttav No"},"customerName":{"type":"string","title":"Customername"},"customerAddress":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Customeraddress"},"customerCity":{"type":"string","title":"Customercity"},"customerState":{"type":"string","title":"Customerstate"},"piecesOnTransport":{"type":"integer","title":"Piecesontransport"},"totalReadyPieces":{"type":"integer","title":"Totalreadypieces"},"weightPerPiece":{"type":"number","title":"Weightperpiece"},"totalWeight":{"type":"number","title":"Totalweight"},"width":{"type":"number","title":"Width"},"isOverwidth":{"type":"boolean","title":"Isoverwidth"},"isLate":{"type":"boolean","title":"Islate"},"earliestDue":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Earliestdue"},"latestDue":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Latestdue"},"isPartial":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Ispartial","default":false},"remainingPieces":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Remainingpieces","default":0},"isRemainder":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Isremainder","default":false},"parentLine":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Parentline"}},"type":"object","required":["truckNumber","so","line","customerName","customerCity","customerState","piecesOnTransport","totalReadyPieces","weightPerPiece","totalWeight","width","isOverwidth","isLate"],"title":"LineAssignment"},"OptimizeResponse":{"properties":{"trucks":{"items":{"$ref":"#/components/schemas/TruckSummary"},"type":"array","title":"Trucks"},"assignments":{"items":{"$ref":"#/components/schemas/LineAssignment"},"type":"array","title":"Assignments"},"sections":{"additionalProperties":{"items":{"type":"integer"},"type":"array"},"type":"object","title":"Sections"}},"type":"object","required":["trucks","assignments","sections"],"title":"OptimizeResponse"},"TruckSummary":{"properties":{"truckNumber":{"type":"integer","title":"Trucknumber"},"customerName":{"type":"string","title":"Customername"},"customerAddress":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Customeraddress"},"customerCity":{"type":"string","title":"Customercity"},"customerState":{"type":"string","title":"Customerstate"},"zone":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Zone"},"route":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Route"},"totalWeight":{"type":"number","title":"Totalweight"},"minWeight":{"type":"integer","title":"Minweight"},"maxWeight":{"type":"integer","title":"Maxweight"},"totalOrders":{"type":"integer","title":"Totalorders"},"totalLines":{"type":"integer","title":"Totallines"},"totalPieces":{"type":"integer","title":"Totalpieces"},"maxWidth":{"type":"number","title":"Maxwidth"},"percentOverwidth":{"type":"number","title":"Percentoverwidth"},"containsLate":{"type":"boolean","title":"Containslate"},"priorityBucket":{"type":"string","title":"Prioritybucket"}},"type":"object","required":["truckNumber","customerName","customerCity","customerState","totalWeight","minWeight","maxWeight","totalOrders","totalLines","totalPieces","maxWidth","percentOverwidth","containsLate","priorityBucket"],"title":"TruckSummary"},"UploadPreviewResponse":{"properties":{"headers":{"items":{"type":"string"},"type":"array","title":"Headers"},"rowCount":{"type":"integer","title":"Rowcount"},"missingRequiredColumns":{"items":{"type":"string"},"type":"array","title":"Missingrequiredcolumns"},"sample":{"items":{"type":"object"},"type":"array","title":"Sample"}},"type":"object","required":["headers","rowCount","missingRequiredColumns","sample"],"title":"UploadPreviewResponse"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}